# Go Shop テストチェックシート

**作成日**: 2025-12-16
**対象バージョン**: v3.1 (QR招待システム軽量版 + 重複チェック実装)

---

## 1. 認証・ユーザー管理

### 1.1 アカウント作成

- [ ] メールアドレス + パスワードで新規登録可能
- [ ] ディスプレイネーム入力必須（空文字でエラー）
- [ ] 登録後、ユーザー名が画面に表示される
- [ ] Firebase Auth displayName に保存される
- [ ] SharedPreferences に保存される

### 1.2 サインイン

- [ ] 既存アカウントでサインイン可能
- [ ] パスワード誤りでエラー表示
- [ ] サインイン後、保存済みユーザー名が表示される

### 1.3 サインアウト

- [ ] サインアウトボタンでログアウト
- [ ] サインアウト後、認証状態が未認証に変わる

---

## 2. デフォルトグループ

### 2.1 自動作成

- [ ] アプリ起動時にデフォルトグループ自動作成
- [ ] groupId = user.uid
- [ ] groupName = "{userName}グループ"
- [ ] syncStatus = local

### 2.2 削除防止

- [ ] UI でデフォルトグループ削除ボタンが非表示
- [ ] Repository で削除試行時にエラー
- [ ] Provider で削除試行時にエラー

### 2.3 UID 変更時

- [ ] データクリア後、新しいデフォルトグループ作成
- [ ] 旧デフォルトグループは削除される

---

## 3. QR招待システム v3.1（軽量版）

### 3.1 招待QRコード生成

- [ ] グループ招待ダイアログでQRコード表示
- [ ] QRコードサイズ: 250px
- [ ] データ内容: invitationId, sharedGroupId, securityKey, type, version
- [ ] データサイズ: 約150文字
- [ ] version: "3.1"

### 3.2 招待QRコードスキャン（新規参加）

- [ ] カメラでQRコードスキャン可能
- [ ] グループ名表示の確認ダイアログ表示
- [ ] 「参加する」ボタンで受諾処理実行
- [ ] 招待元に通知送信
- [ ] 「招待元の確認をお待ちください」メッセージ表示

### 3.3 招待QRコードスキャン（重複参加チェック）✅ NEW

- [ ] **既に参加しているグループのQRスキャン時**
- [ ] 確認ダイアログを表示せず、即座にメッセージ表示
- [ ] **「すでに「{groupName}」に参加しています」メッセージ**
- [ ] スキャナー画面が自動的に閉じる
- [ ] 招待元に通知は送信されない

### 3.4 招待受諾（招待元側）

- [ ] 通知を受け取る
- [ ] グループメンバーリストに受諾者が追加される
- [ ] 受諾者の名前が正しく表示される
- [ ] allowedUid に受諾者 UID が追加される

### 3.5 招待管理

- [ ] 招待一覧表示（pending状態のみ）
- [ ] 使用状況表示: "残り X/5 回"
- [ ] currentUses が maxUses に達したら使用不可
- [ ] 削除ボタンで招待削除可能
- [ ] コピーボタンでQRデータコピー

---

## 4. グループ管理

### 4.1 グループ作成

- [ ] グループ名入力で新規作成
- [ ] 作成者が owner として登録される
- [ ] グループ一覧に表示される

### 4.2 グループ選択

- [ ] グループ一覧から選択可能
- [ ] 選択したグループが currentGroup に設定される
- [ ] ホーム画面にグループ名表示

### 4.3 グループ削除

- [ ] デフォルトグループは削除不可
- [ ] 通常グループは削除可能
- [ ] Firestore から削除される
- [ ] Hive から削除される
- [ ] 他デバイスで即座に反映

---

## 5. 買い物リスト管理

### 5.1 リスト作成

- [ ] リスト名入力で新規作成
- [ ] 作成後、ドロップダウンで選択状態になる
- [ ] Firestore に同期される
- [ ] 他デバイスで即座に表示される

### 5.2 リスト削除

- [ ] リスト削除ボタンで削除
- [ ] Firestore から削除される
- [ ] 他デバイスで即座に削除反映

### 5.3 リスト選択

- [ ] ドロップダウンでリスト切り替え
- [ ] 選択リストのアイテムが表示される

---

## 6. 買い物アイテム管理

### 6.1 アイテム追加

- [ ] アイテム名 + 数量で追加
- [ ] 追加したユーザーの memberId が記録される
- [ ] Firestore に同期される
- [ ] 他デバイスで即座に表示される

### 6.2 アイテム購入状態切り替え

- [ ] チェックボックスで購入/未購入切り替え
- [ ] purchaseDate が記録される
- [ ] Firestore に即座に同期
- [ ] 他デバイスで即座に反映

### 6.3 アイテム削除

- [ ] 削除ボタンでアイテム削除（ソフトデリート）
- [ ] isDeleted = true に変更
- [ ] UI に表示されなくなる
- [ ] Firestore に同期

### 6.4 定期購入アイテム自動リセット

- [ ] shoppingInterval 設定されたアイテム
- [ ] purchaseDate + interval 日数経過で自動リセット
- [ ] isPurchased = false に変更
- [ ] アプリ起動5秒後にバックグラウンド実行

---

## 7. リアルタイム同期

### 7.1 Firestore → Hive 同期

- [ ] Firestore でデータ変更時、Hive に自動反映
- [ ] グループ追加が即座に反映
- [ ] リスト追加が即座に反映
- [ ] アイテム追加が即座に反映

### 7.2 Hive → Firestore 同期

- [ ] ローカル変更が Firestore に送信される
- [ ] syncStatus が pending → synced に変更

### 7.3 StreamBuilder によるリアルタイム UI 更新

- [ ] アイテム追加時、画面遷移なしで即座に表示
- [ ] アイテム購入状態変更が即座に反映
- [ ] 他デバイスの変更が1秒以内に反映

---

## 8. アプリモード切り替え

### 8.1 モード切り替え

- [ ] 設定画面で「買い物リスト」⇄「TODOタスク管理」切り替え
- [ ] モード変更が即座に UI に反映

### 8.2 用語の動的変更

- [ ] 買い物モード: グループ、リスト、アイテム
- [ ] TODO モード: チーム、プロジェクト、タスク
- [ ] 50+ の用語が自動変換

---

## 9. プライバシーモード

### 9.1 シークレットモード

- [ ] 設定画面でシークレットモード切り替え
- [ ] アカウント作成前: デフォルトグループのみ表示
- [ ] アカウント作成後: すべてのグループ表示

---

## 10. エラーハンドリング

### 10.1 ネットワークエラー

- [ ] Firestore 接続失敗時、Hive からデータ取得
- [ ] 赤い同期アイコン表示
- [ ] ネットワーク復旧後、自動再接続

### 10.2 認証エラー

- [ ] 認証失敗時、適切なエラーメッセージ表示
- [ ] 「email-already-in-use」→ 日本語メッセージ
- [ ] 「wrong-password」→ 日本語メッセージ

---

## 11. パフォーマンス

### 11.1 起動速度

- [ ] アプリ起動が 3 秒以内
- [ ] Firebase 初期化が正常完了

### 11.2 データ同期速度

- [ ] アイテム追加が 1 秒以内に反映
- [ ] 他デバイスへの同期が 3 秒以内

---

## 12. マルチデバイス動作

### 12.1 2 台同時使用

- [ ] 2 台で同じアカウントでサインイン可能
- [ ] 片方でデータ追加、もう片方で即座に表示
- [ ] WiFi 環境で 2 台同時接続可能
  - ⚠️ 既知の問題: 同一WiFiで2台接続時、1台が同期エラーの可能性
  - 回避策: 1台をモバイル回線に切り替え

---

## 13. Windows デバッグ環境

### 13.1 launch.json デバイス選択

- [ ] F5 でデバイス選択可能
- [ ] 「go_shop (dev) - SH 54D」で SH 54D 起動
- [ ] 「go_shop (dev) - TBA1011」で TBA1011 起動

### 13.2 ADB ワイヤレス接続

- [ ] adb connect で接続可能
- [ ] flutter devices でデバイス認識

---

## テスト環境

### 推奨構成

- **デバイス 1**: WiFi 接続（デバッグ実行）
- **デバイス 2**: モバイル回線（インストール済み APK）
- **理由**: 同一 WiFi での 2 台同時 Firestore 接続エラー回避

### 使用デバイス

- SH 54D: Android 15 (API 35), IP: 192.168.0.12:39955
- JA5 TBA1011: Android 15 (API 35), IP: 192.168.0.25:45361

---

## 既知の問題

### WiFi 環境での Firestore 同期エラー

- **現象**: 同一 WiFi で 2 台同時接続時、1 台が同期エラー
- **回避策**: 1 台をモバイル回線に切り替え
- **原因**: WiFi ルーターのファイアウォール/NAT 設定の可能性
- **ステータス**: 調査中

---

## テスト実施記録

| 日付 | テスト項目 | 結果 | 備考 |
|------|-----------|------|------|
| 2025-12-16 | QR 招待重複チェック | ✅ PASS | すでに参加しているグループのQRスキャン時、適切なメッセージ表示 |
| 2025-12-15 | QR 招待 v3.1 軽量版 | ✅ PASS | データサイズ 75%削減、スキャン成功 |
| 2025-12-08 | リスト削除の Firestore 同期 | ✅ PASS | 削除が他デバイスに即座に反映 |
| 2025-11-22 | リアルタイム同期 Phase 1 | ✅ PASS | StreamBuilder による自動 UI 更新 |

---

## チェックリスト記入例

```
✅ 完了・正常動作
⚠️ 部分的に動作・既知の問題あり
❌ 未実装・動作不良
📝 テスト待ち
```
